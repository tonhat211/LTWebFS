<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng</title>

    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--fontawesome-->
    <link rel="stylesheet" href="assets/font/fontawesome-free-6.4.0-web/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!--    google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/cart.css">
    <link rel="stylesheet" href="assets/css/baseN.css">
    <link rel="stylesheet" href="assets/css/adminProduct.css">

    <link rel="stylesheet" href="./assets/fonts/fontawesome-free-6.4.0-web/css/all.min.css">
</head>
<body>
<main id="main" class="main">
    <div class="ad_content">
        <div class="cart__container">
            <form action="">
                <div class="grid">
                    <div class="grid__row">
                        <div class="grid-col-9">
                            <h2 class="title">Gio hang</h2>
                            <p class="title">Ban co 4 san pham trong gio hang</p>
                            <table class="table">
                                <thead>
                                <tr>
                                    <th scope="col">Chon</th>
                                    <th scope="col">Hinh anh</th>
                                    <th scope="col">Tên san pham</th>
                                    <th scope="col">Đơn giá</th>
                                    <th scope="col">So luong</th>
                                    <th scope="col">Xoa</th>

                                </tr>
                                </thead>
                                <tbody>

                                <tr class="roww">
                                    <th scope="row">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="employee" value="14" checked>
                                            <!--                                    <label class="form-check-label" for="employee">-->
                                            <!--                                        Nhân viên-->
                                            <!--                                    </label>-->
                                        </div>
                                    </th>
                                    <td style="height: 100px" ><img src="./assets/img/products/mat-na-mui-cho-may-tho-bmc-p2-1.jpg" alt="" style="height: 100%"></td>

                                    <td>Mat na mui</td>
                                    <td>1000000</td>
                                    <td>
                                        <div class="product-qty-control">

                                            <i class="fa-solid fa-plus qty-control btn-plus-qty increaseBtn"></i>
                                            <input type="text" class="product-qty-input qty" value="1" maxlength="2" size="2">
                                            <i class="fa-solid fa-minus qty-control btn-minus-qty decreaseBtn"></i>

                                        </div>
                                    </td>
                                    <td style="text-align: center"><i class="fa-solid fa-x deleteProductBtn"></i></td>
                                </tr>
                                <tr class="">
                                    <th scope="row">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="employee" value="12" checked>
                                            <!--                                    <label class="form-check-label" for="employee">-->
                                            <!--                                        Nhân viên-->
                                            <!--                                    </label>-->
                                        </div>
                                    </th>
                                    <td style="height: 100px" ><img src="./assets/img/products/mat-na-mui-cho-may-tho-bmc-p2-1.jpg" alt="" style="height: 100%"></td>

                                    <td>Mat na mui</td>
                                    <td>1000000</td>
                                    <td>
                                        <div class="product-qty-control">

                                            <i class="fa-solid fa-plus qty-control btn-plus-qty increaseBtn" ></i>
                                            <input type="text" class="product-qty-input qty" value="1" maxlength="2" size="2">
                                            <i class="fa-solid fa-minus qty-control btn-minus-qty decreaseBtn"></i>

                                        </div>
                                    </td>
                                    <td style="text-align: center"><i class="fa-solid fa-x deleteProductBtn"></i></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="grid-col-3 money">
                            <h2 class="title">Tong tien</h2>
<!--                            <h2>Tong tien</h2>-->
                            <p style="font-size: 14px"><span class="totalMoney">10000000</span> (VND) </p>
                            <p style="font-size: 14px">Tong san pham: <span class="totalProduct">2</span> (san pham) </p>
                            <div class="ad_func-container">
                                <button class="btn btn-primary btn-buy" type="submit">thanh toan</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>




        </div>
    </div>


</main>

<script>
    // const $ = document.querySelector.bind(document);
    // const $$ = document.querySelectorAll.bind(document);
    // const items = $$('.form-check-input');
    // const totalMoney = $('.totalMoney');

    $(document).ready(function() {
        $(".increaseBtn").click(function() {
            var cartId = $(this).siblings(".idcart").val();
            var productId = $(this).siblings(".idproduct").val(); // Lấy ID sản phẩm
            var quantityInput = $(this).siblings(".product-qty-input.qty");
            var currentQuantity = parseInt(quantityInput.val());
            quantityInput.val(currentQuantity + 1); // Tăng số lượng lên 1
            updateQuantity(cartId, productId, quantityInput.val()); // Gọi hàm cập nhật số lượng
        });

        $(".decreaseBtn").click(function() {
            var cartId = $(this).siblings(".idcart").val();
            var productId = $(this).siblings(".idproduct").val(); // Lấy ID sản phẩm
            var quantityInput = $(this).siblings(".product-qty-input.qty");
            var currentQuantity = parseInt(quantityInput.val());
            if (currentQuantity > 1) {
                quantityInput.val(currentQuantity - 1); // Giảm số lượng đi 1
                updateQuantity(cartId, productId, quantityInput.val()); // Gọi hàm cập nhật số lượng
            }
        });

        $(".deleteProductBtn").click(function() {
            // var productId = this.parentNode.querySelector('.idproduct').value;
            // var cartId = this.parentNode.querySelector('.idcart').value;
            // var quantityInput = $(this).siblings(".product-qty-input.qty");
            // var currentQuantity = 1;
            console.log(this.parentNode.parentNode);
            // quantityInput.val(currentQuantity - 1); // Giảm số lượng đi 1
            // if(currentQuantity -1 == 0) {
            //     var productElement = document.getElementById("item" + cartId + "=" + productId);
            //     if (productElement) {
            //         productElement.remove(); // Xóa phần tử khỏi DOM
            //     }
            // }
            // updateQuantity(cartId, productId, quantityInput.val()); // Gọi hàm cập nhật số lượng
            // }


        });
        // Hàm cập nhật số lượng
        function updateQuantity(cartId, productId, quantity) {
            $.ajax({
                url: "update-cart", // Đường dẫn đến Servlet
                method: "POST",
                data: { cartId:cartId, productId: productId, quantity: quantity },
                success: function(data) {
                    console.log("Số lượng đã được cập nhật thành công!"); // Log thông báo thành công
                }
            });
        }
    });





    // items.forEach(function(item) {
    //     item.addEventListener('change', function() {
    //         var total = 0;
    //         items.forEach(function(chk) {
    //             if (chk.checked) {
    //                 total += parseInt(chk.value);
    //             }
    //         });
    //         totalMoney.textContent = total;
    //     });
    // });


    // console.log(items);
    function plusQty() {
        const qty = document.querySelector('.product-qty-input');
        let num = parseInt(qty.value);
        num++;
        qty.value = num;
    }

    function minusQty() {
        // console.log("1");
        const qty = document.querySelector('.product-qty-input');
        let num = parseInt(qty.value);
        num--;
        if(num>=0) {
            qty.value = num;
        }
        else {
            qty.value = 0;
        }
    }


    const plusBtn = document.querySelector('.btn-plus-qty');


    plusBtn.addEventListener('click', plusQty);


    const minusBtn = document.querySelector('.btn-minus-qty');

    minusBtn.addEventListener('click', minusQty);

</script>





</body>
</html>
